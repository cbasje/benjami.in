---
import { useSanityClient } from "astro-sanity";
import i18next, { changeLanguage } from "i18next";

import { projectsQuery } from "../../../lib/queries";
import type { Project, Seo } from "../../../lib/types";
import BlockManager from "../../components/BlockManager.astro";
import Image from "../../components/Image.astro";
import ProjectsLayout from "../../layouts/project.astro";

changeLanguage("en");

export interface Props {
    project: Project;
}
const { project } = Astro.props;

const projectColor = project.colour
    ? `--colors-${project.colour}900`
    : undefined;

const seo: Seo = {
    metaTitle: project.title,
    metaDescription: project.description,
    shareImage: project.mainImage,
    isArticle: true,
};

export async function getStaticPaths() {
    const projects: Project[] = await useSanityClient().fetch(projectsQuery, {
        locale: i18next.language,
    });
    return projects.map((p) => ({
        params: { slug: p.slug },
        props: { project: p },
    }));
}
---

<ProjectsLayout colour={project.colour} seo={seo}>
    <div class="flex" style={{ flexDirection: "column" }}>
        <h1 class="heading">{project.title}</h1>
        <div class="grid" style={{ gridTemplateColumns: "repeat(2, 1fr)" }}>
            <div class="flex" style={{ flexDirection: "column" }}>
                <h3 class="description">
                    {project.description}
                </h3>

                <div class="flex">
                    <span>
                        {
                            new Intl.DateTimeFormat(i18next.language, {
                                month: "long",
                                year: "numeric",
                            }).format(new Date(project.publishedAt))
                        }
                    </span>

                    {
                        project.company && (
                            <>
                                <span>-</span>
                                {project.company.url ? (
                                    <a href={project.company.url}>
                                        {project.company.title}
                                    </a>
                                ) : (
                                    <span>{project.company.title}</span>
                                )}
                            </>
                        )
                    }

                    {
                        project.categories && (
                            <>
                                <span>-</span>
                                {project.categories
                                    .map((c) => c.title)
                                    .join(", ")}
                            </>
                        )
                    }
                </div>
            </div>

            <p>{project.excerpt}</p>
        </div>
    </div>

    <div class="banner">
        <Image src={project.mainImage} fillContainer />
    </div>

    <BlockManager value={project.content} />
</ProjectsLayout>

<style lang="scss">
    .heading {
        margin: 0;
        font-size: 2rem;
    }
    .description {
        margin: 0;
        font-size: 1.5rem;
    }

    .banner {
        width: 100%;
        height: auto;
        border-radius: var(--radii-sm);
        aspect-ratio: 3 / 2;
        overflow: hidden;
        background-color: rgb(var(--projectColor));
    }
</style>
