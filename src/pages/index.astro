---
import { astroI18n, l } from "astro-i18n";
import { useSanityClient } from "astro-sanity";
import { homeQuery } from "../../lib/queries";
import type { Home } from "../../lib/types";
import Footer from "../components/Footer.astro";
import RotaryDial from "../components/RotaryDial.svelte";
import SanityImage from "../components/SanityImage.astro";
import MainLayout from "../layouts/main.astro";

astroI18n.init(Astro);

const homepage: Home = await useSanityClient().fetch(homeQuery, {
    locale: astroI18n.langCode,
});
const links = homepage.links.map((el) => {
    if (el.slug) {
        return l(`/${el.slug}`);
    } else if (el.url) {
        return el.url;
    } else {
        return "#";
    }
});
---

<MainLayout seo={homepage.seo}>
    <main>
        <div class="dial-wrapper">
            <RotaryDial elementSlugs={links} client:only>
                {
                    homepage.links.map((el, i) => (
                        // <li class:active={i % 10 === num}>
                        <li
                            role="listitem"
                            style={
                                el.colour
                                    ? `--background: var(--theme-gradient-${el.colour})`
                                    : "--background: var(--theme-surface-2)"
                            }
                        >
                            {el.image && (
                                <a
                                    href={links[i]}
                                    title={`Link to my ${el.title}`}
                                    rel={
                                        !links[i].startsWith("/")
                                            ? "nofollow me"
                                            : undefined
                                    }
                                >
                                    <SanityImage
                                        alt={`Main image of ${el.title}`}
                                        src={el.image}
                                        width={512}
                                        height={576}
                                    />
                                </a>
                            )}
                        </li>
                    ))
                }
            </RotaryDial>
        </div>

        <Footer />
    </main>
</MainLayout>

<script>
    import { animate, stagger } from "motion";

    // Animate sections on loading
    animate(
        "main > *",
        {
            opacity: [0, 1],
        },
        {
            duration: 0.75,
            easing: [0.43, 0.13, 0.23, 0.96],
            delay: stagger(0.25),
        }
    );
</script>

<style lang="scss">
    @import "open-props/media";

    main {
        min-height: 100vh;
        margin-inline: auto;
        padding-inline: var(--size-1);
        padding-block: var(--size-3);

        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: var(--size-8);

        > :global(*) {
            width: 100%;
            max-width: 1024px;
        }

        .dial-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    }

    @media (--md-n-above) {
        main {
            padding: var(--size-3);
        }
    }
</style>
