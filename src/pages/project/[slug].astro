---
import { astroI18n } from "astro-i18n";
import { useSanityClient } from "astro-sanity";
import { projectsQuery } from "../../../lib/queries";
import type { Project, Seo } from "../../../lib/types";
import BlockManager from "../../components/BlockManager.astro";
import SanityImage from "../../components/SanityImage.astro";
import ProjectsLayout from "../../layouts/project.astro";

astroI18n.init(Astro);

export interface Props {
    project: Project;
}
const { project } = Astro.props;
const seo: Omit<Seo, "_type"> = {
    metaTitle: project.title,
    metaDescription: project.description,
    shareImage: project.headerImage,
    isArticle: true,
};
export async function getStaticPaths() {
    const projects: Project[] = await useSanityClient().fetch(projectsQuery, {
        locale: astroI18n.langCode,
    });
    return projects.map((p) => ({
        params: { slug: p.slug },
        props: { project: p },
    }));
}
---

<ProjectsLayout colour={project.colour} seo={seo}>
    <header>
        <h1>{project.title}</h1>
        <div class="intro" role="presentation">
            <div role="complementary">
                <h2 class="description">
                    {project.description}
                </h2>

                <div role="none">
                    <span>
                        {
                            new Intl.DateTimeFormat(astroI18n.langCode, {
                                month: "long",
                                year: "numeric",
                            }).format(new Date(project.publishedAt))
                        }
                    </span>

                    {
                        project.company && (
                            <>
                                <span>-</span>
                                {project.company.url ? (
                                    <a href={project.company.url}>
                                        {project.company.title}
                                    </a>
                                ) : (
                                    <span>{project.company.title}</span>
                                )}
                            </>
                        )
                    }

                    {
                        project.categories && (
                            <>
                                <span>-</span>
                                <div class="categories">
                                    {project.categories.map((c) => (
                                        <a class="button">{c.title}</a>
                                    ))}
                                </div>
                            </>
                        )
                    }
                </div>
            </div>

            <p role="doc-preface">{project.excerpt}</p>
        </div>
    </header>

    <div role="banner">
        <SanityImage
            alt={`Header image of ${project.title}`}
            src={project.headerImage}
            width={1024}
            height={683}
            fillContainer
        />
    </div>

    <BlockManager value={project.content} />
</ProjectsLayout>

<style
    lang="scss"
    define:vars={{
        background: project.colour
            ? `var(--theme-gradient-${project.colour})`
            : "var(--theme-surface-2)",
    }}
>
    @import "open-props/media";

    header {
        display: flex;
        flex-direction: column;
        gap: var(--size-2);

        h1 {
            font-size: var(--font-size-6);
            line-height: var(--font-lineheight-1);
        }

        div.intro {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--size-4);

            > div {
                display: flex;
                flex-direction: column;
                gap: var(--size-2);

                h2.description {
                    margin: 0;
                    font-size: var(--font-size-4);
                    font-weight: var(--font-weight-4);
                    line-height: var(--font-lineheight-0);
                }

                > div {
                    display: flex;
                    flex-direction: row;
                    gap: var(--size-2);

                    > div.categories {
                        display: flex;
                        flex-direction: row;
                        gap: var(--size-1);

                        > :global(a) {
                            margin: 0;
                            padding-block: 0;
                            padding-inline: var(--size-2);
                            /* background: var(--color-blue-2); */

                            &:not(:hover) {
                                border-color: var(--theme-surface-3);
                            }
                        }
                    }
                }
            }
        }
    }

    div[role="banner"] {
        width: 100%;
        height: auto;
        border-radius: var(--radius-2);
        aspect-ratio: 3 / 2;
        overflow: hidden;
        background: var(--background);
    }

    @media (--md-n-above) {
        header {
            div.intro {
                gap: var(--size-5);
                grid-template-columns: repeat(2, 1fr);
            }
        }
    }
</style>
