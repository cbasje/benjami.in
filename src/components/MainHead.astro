---
import { HeadHrefLangs } from "astro-i18next/components";
import { useSanityClient } from "astro-sanity";
import { SEO } from "astro-seo";
import i18next from "i18next";
import { globalQuery } from "../../lib/queries";
import type { Seo } from "../../lib/types";

import "../styles/variables.scss";
import "../styles/global.scss";
import "../styles/components.scss";

export interface Props {
    seo?: Seo;
}

const { seo } = Astro.props;

const { defaultSeo, siteName } = await useSanityClient().fetch(globalQuery, {
    locale: i18next.language,
});

const seoWithDefaults: Seo = {
    ...defaultSeo,
    ...seo,
};

const fullSeo = {
    ...seoWithDefaults,
    metaTitle:
        seoWithDefaults.metaTitle === siteName
            ? siteName
            : `${seoWithDefaults.metaTitle} | ${siteName}`,
};
---

<head>
    <meta charset="UTF-8" />
    <SEO
        title={fullSeo.metaTitle}
        description={fullSeo.metaDescription}
        openGraph={{
            basic: {
                type: fullSeo.isArticle ? "article" : "website",
                title: seoWithDefaults.metaTitle,
                image: fullSeo.shareImage ?? "",
            },
        }}
        twitter={{
            card: "summary_large_image",
            site: "@cbasje",
            creator: "@cbasje",
        }}
        extend={{
            link: [{ rel: "shortcut icon", href: "/favicon.ico" }],
            meta: [
                { name: "viewport", content: "width=device-width" },
                { name: "generator", content: Astro.generator },
            ],
        }}
    />
    <script
        defer
        data-domain="benjami.in"
        src="https://plausible.io/js/script.js"
    ></script>

    <HeadHrefLangs />
</head>
