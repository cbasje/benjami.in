---
import { urlForImage } from "../../lib/sanity";
import type { Image } from "../../lib/types";

export interface Props {
    src: Image;
    width: number;
    height?: number;
    alt?: string;
}
const { src, width, height, alt } = Astro.props;

const aspectRatioLg = height ? width / height : 2 / 3;
const heightLg = height ? height : Math.round(width * aspectRatioLg);

const aspectRatioSm = height ? width / height : 6 / 5;
const widthSm = Math.round(width / 2);
const heightSm = height
    ? Math.round(height / 2)
    : Math.round(widthSm * aspectRatioSm);

const srcLg = urlForImage(src)
    .width(width)
    .height(heightLg)
    .format("webp")
    .quality(100)
    .fit("max")
    .url();
const srcSm = urlForImage(src)
    .width(widthSm)
    .height(heightSm)
    .format("webp")
    .quality(100)
    .fit("max")
    .url();
---

<figure>
    <picture>
        <source media="(min-width: 768px)" srcset={srcLg} />
        <img src={srcSm} alt={alt ?? src.alt} loading="lazy" />
    </picture>
    {src.caption && <figcaption>{src.caption}</figcaption>}
</figure>

<style lang="scss">
    picture {
        width: 100%;

        img {
            object-fit: cover;
            width: 100%;
        }
    }
</style>
